{% extends 'base.html.twig' %}

{% block body %}

<div class="container-xxl py-5">
    <div class="container">
        <div class="text-center mx-auto mb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 600px;">
            <p class="d-inline-block border rounded-pill py-1 px-4">Wellspring Pharmacy</p>
            <h1>Store</h1>
        </div>

        <div class="row g-4">
            <div class="col-lg-6 pe-lg-0 wow fadeIn" data-wow-delay="0.5s" style="min-height: 400px;">
                <div class="position-relative h-100">
                    <img src="{{ asset('img/' ~ medicament.image) }}" alt="{{ medicament.name }}" class="card-img-top img-fluid">
                </div>
            </div>
            <div class="col-md-6 col-lg-6 mb-6">
                <div class="card h-100 service-item shadow-sm">
                    <div class="card-body p-4">
                        <h4 class="card-title text-center">{{ medicament.name }}</h4>
                        <p class="card-text">{{ medicament.description }}</p>

                        <!-- Quantity input on a new line -->
                        <div class="mb-3">
                            <label for="quantity" class="form-label">Quantity: {{ medicament.quantity }}</label>
                            <input type="number" id="quantity" name="quantity" class="form-control" value="1" min="1">
                        </div>

                        <!-- Price on a new line -->
                        <div class="mb-3">
                            <span class="text-muted">Price: {{ medicament.price }} â‚¬</span>
                        </div>

                        <!-- QR Code on a new line -->
                        <div class="mb-3">
                            {% if medicament.qrCodePath %} 

                                <img src="{{ asset('img/' ~  medicament.qrCodePath) }}" alt="QR Code" class="img-fluid" style="width: 100px;">
                            {% else %}
                                <p>No QR Code available for this medicament.</p>
                            {% endif %}
                        </div>

                        <!-- "Sell Medicament" button on a new line -->
                        <div>
                            <a href="{{ path('sell_medicament', {'id': medicament.id, 'quantity': 1}) }}" class="btn btn-primary">Sell Medicament</a>
                        </div>

                        <!-- Flash messages for error handling -->
                        {% for flash_message in app.flashes('danger') %}
                            <div class="alert alert-danger mt-3">
                                {{ flash_message }}
                            </div>
                        {% endfor %}

                        <!-- Chatbot input field and submit button -->
                        <div class="mt-4">
                            <input type="text" id="chatbot-input" class="form-control" placeholder="Ask a question...">
                            <button onclick="askChatbot()" class="btn btn-secondary mt-2">Ask</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chatbot container -->
        <div id="chatbot-container" class="mt-5">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Chatbot</h5>
                    <ul id="chatbot-messages">
                        {% for message in chatbotMessages %}
                            <li>{{ message }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function askChatbot() {
        // Get the user's question from the input field
        var userQuestion = document.getElementById('chatbot-input').value;

        // Append the user's question to the chatbot messages
        var chatbotMessages = document.getElementById('chatbot-messages');
        var userQuestionElement = document.createElement('li');
        userQuestionElement.innerText = 'You: ' + userQuestion;
        chatbotMessages.appendChild(userQuestionElement);

        // Simulate chatbot responses based on specific questions
        var chatbotResponse = document.createElement('li');
        if (userQuestion.toLowerCase().includes('gripex')) {
            chatbotResponse.innerText = 'Chatbot: For Gripex, you should take it three times a day.';
        } else if (userQuestion.toLowerCase().includes('panadole1000')) {
            chatbotResponse.innerText = 'Chatbot: Panadole 1000 is typically for adults. Please consult with a healthcare professional for personalized advice.';
        } else if (userQuestion.toLowerCase().includes('glucophage')) {
            chatbotResponse.innerText = 'Chatbot: Do you have any other diseases or conditions? This information can help provide more accurate guidance.';
        } else if (userQuestion.toLowerCase().includes('yes')) {
            chatbotResponse.innerText = 'Chatbot: tell me more about your conditions? This information can help provide more accurate guidance.';
        } else {
            // Default response for other questions
            chatbotResponse.innerText = 'Chatbot: Thank you for your question. I am a simple chatbot and cannot provide real answers.';
        }

        // Append the chatbot response to the messages
        chatbotMessages.appendChild(chatbotResponse);

        // Clear the input field after asking the question
        document.getElementById('chatbot-input').value = '';
    }
</script>

{% endblock %}
